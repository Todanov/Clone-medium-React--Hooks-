import React, { useEffect, Fragment } from 'react'
import s from './yourfeed.module.css'
import {stringify} from 'query-string'

import useFetch from 'hooks/useFetch'
import Feed from 'components/Feed/Feed'
import {getPagination, limit} from 'utilits/utilits'
import Paginations from 'components/pagination/pagination'
import Loading from 'components/Loading/Loading'
import ErrorMassege from 'components/Error/ErrorMessage'
import PopularTags from 'components/tags/tags'
import FeedToggle from 'components/FeedToggler/FeedToggler'
  
const YourFeed = ({location, match}) => {
    const {offset, currentPage} = getPagination(location.search)
    const stringifiedParams = stringify ({
        limit,
        offset
    })
    const apiUrl = `/articles/feed?${stringifiedParams}`
    const [{response,isLoading,error},doFetch]=useFetch(apiUrl)

    const url = match.url 
  
    useEffect(()=>{
        doFetch()
    }, [doFetch ,currentPage])

    return (
        <div className={s.container}>
            <div className={s.medium}>
                <h1 className={s.name}>Medium Clone</h1>
                <p className={s.info}> A Place share knowledge</p>
            </div>    
            <div className={s.post}>
                <FeedToggle />
                 {isLoading && <Loading/>}
                 {error && <ErrorMassege/>}
                 {!isLoading && response &&
                 (<Fragment>
                        <Feed articles={response.articles}/>
                        <Paginations
                        total ={response.articlesCount  }
                        limit={limit}
                        url = {url}
                        currentPage={currentPage}
                        />
                 </Fragment>) }
            </div>
            <div className={s.sidebar}>
            <PopularTags/>      
           </div>
        </div>
    )
}

export default YourFeed